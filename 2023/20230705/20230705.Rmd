---
title: "20230705"
output:
  xaringan::moon_reader:
    css: ["default", "css/xaringan-themer.css"]
    lib_dir: libs
    self_contained: false
    fig_caption: true
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: "16:9"
    seal: false
---

class: title
image-opacity: 0.1
background-image: url("figures/cover.png")
background-size: cover

```{r, echo = FALSE, warnings = FALSE, message = FALSE}
library(RefManageR)
library(knitr)
library(tidyverse)
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = TRUE, dpi = 200, fig.align = "center", fig.width = 6, fig.height = 3, eval = TRUE)
opts_knit$set(eval.after = "fig.cap")

BibOptions(cite.style = "numeric")
bib <- ReadBib("references.bib")
```

.center[
<br/>
# Ecosystem Modeling using Multimodal Data
<br/>
<br/>
<br/>
<br/>
]

#### Microsoft AI for Social Good Lab

.large[
Kris Sankaran <br/>
05 | July | 2023 <br/>
https://github.io/krisrs1128/LSLab
<br/>
]

---

### Introduction

These themes have recurred across almost all the projects I have encountered in
my research:

* **Multimodality**: Data are gathered from complementary sensors or assays.
* **Ecosystem Analysis**: We would like to understand the interactions in a landscape that are difficult to observe except through data.

---

### Multimodality Setup

.center[
<img width=850 src="figure/multimodal.png"/>
]

---

### Multimodal Regression

* If the goal is to predict a response from several sources, it can be helpful to
use dimensionality reduction that emphasizes shared structure.
* For example, cooperative learning `r Citep(bib, "Ding2021CooperativeLF")` solves:
\begin{align*}
\arg\min_{\beta_1 \in \mathbb{R}^{P_{1}}, \beta_2 \in \mathbb{R}^{P_2}} &\frac{1}{2}\left\|y-X_{1} \beta_{1}-X_{2} \beta_{2}\right\|^2+\frac{\rho}{2}\left\|\left(X_{1} \beta_{1}-X_{2} \beta_{2}\right)\right\|^2  + \\ 
&\lambda_1\left\|\beta_{1}\right\|_1+\lambda_2\left\|\beta_{2}\right\|_1 .
\end{align*}
  The second term is similar to the CCA objective, highlighting shared structure across tables

---

### Multimodal Dimensionality Reduction

* Canonical correlation analysis looks for shared structure across sources,
\begin{align*}
\arg\min_{u \in \mathbb{R}^{P_1}, v \in \mathbb{R}^{P_2}} &\operatorname{Cov}_{\mathbf{P}^{X_{1}X_{2}}}\left[z_i^{(1)}(u), z_i^{(2)}(v)\right] \\
\text { subject to } &\operatorname{Var}_{\mathbf{P}^X_{1}}\left(z_i^{(1)}(u)\right)= \operatorname{Var}_{\mathbf{P}^{X_{2}}}\left(z_i^{(2)}(v)\right)=1
\end{align*}
where $z_i^{(1)}(u)=u^T x^{(1)}_i$ and $z_i^{(2)}(v)=v^T x^{(2)}_i$ are linear feature extractors.

* In modern settings, it's often useful to introduce sparsity `r Citep(bib, c("Witten2009APM", "Gao2014SparseCA"))` or nonlinearity `r Citep(bib, c("Andrew2013DeepCC", "Wang2015OnDM"))`.

---

### Non-Exchangeability

We often have context about how samples are related to one another, and using
this information can improve power.

.pull-left[
- Spatial or temporal structure
- Cohort or batch effects
- Network structure
]

.pull-right[
<img src="figure/nonexchangeability.png"/>
]

---

### Mosaics

Often, the same measurements are not available across all samples. We need to
integrate across sources without assuming uniform collection.

.center[
<img width=750 src="figure/mosaic.png"/>
]

---
background-color: #f7f7f7
background-image: url("figure/multimodal-glaciers-cover.png")
background-size: contain

.center[
## Multimodality in Earth Observation
]

---

### Glacier Monitoring

* Glaciers provide significant ecosystem resources, and their disappearance has a large impact on the communities around them.
* Effective remote sensing data analysis could help generate maps over large areas much faster than human annotation could.

.pull-left[
<img width=300 src="figure/Blue-logo-on-a-white-background.jpg"/>
]
.pull-right[
<a href="https://news.microsoft.com/on-the-issues/2021/01/12/ai-open-data-glacial-melt-himalaya/"><img width=300 src="figure/glaciers-article.png"/></a>
]

---

### Glacier Monitoring

Semantic segmentation models can be trained to distinguish different types of
glaciers and estimate glacial lake areas `r Citep(bib, c("Baraka2020MachineLF", "Zheng2021InteractiveVA", "Ortiz2022MappingGL"))`

.pull-left[
<img src="figure/glacier_lakes_trends.png"/>
<img src="figure/glacier_lakes_volcano.png" width=250/>
]
.pull-right[
<img src="figure/glacier_lakes_errors.png"/>
]
 
[Colab Notebook](https://colab.research.google.com/drive/1ZkDtLB_2oQpSFDejKZ4YQ5MXW4c531R6?usp=sharing#scrollTo=r9jkq9qYcX_-)

---

### Multimodal Data

* There is a trade-off between spatial and spectral resolution when working with data from different satellite sensors.
* The sources are always changing. If we would like to build maps over long periods, we need to integrate them.
* It is also possible to integrate ground-level ecosystem data, like species counts from wildlife monitoring apps.
* The dream would be to build models that automatically get better as new sources become available.

(Figure of )

---

### An Experiment

* How robust is multimodal segmentation to modality missingness?
* Can we train models in contexts where all sources are available and then directly apply them to settings where some are not?

(Figure of Transformers)

Yuliang Peng led this project.

---

### Study Design

We studied Segformer models [Ref3] with early, middle, and late fusion.

---

### Results

---

### Opportunities


---

.center[
## Multimodality in Microbiome Studies
]

---

### Bacterial Vaginosis

.pull-left[
* Bacterial Vaginosis (BV) affects 20% of women worldwide, with elevated rates in Sub-Saharan Africa. It is a known risk factor for preterm birth and HIV transmission.
* BV is a disease of imbalance -- it doesn't come from a single pathogen, but rather interactions across the microbial community / host immune system.
]

.pull-right[
<img src="figure/bv_overview.jpg" width=500/>
Figure from `r Citep(bib, "Mitchell2014BacterialVA")`.
]

---

### Bacterial Vaginosis

* Several initiatives, including the Gates Foundation-funded Vaginal Microbiome Research Consortium, are gathering multimodal molecular ("multi-omics") profiles to clarify the mechanisms behind disease development and recurrence
* The goal is to use these multi-omics profiles to design precision treatments.
  * E.g., new probiotics, vaginal fluid/microbiome transplants
  
---

### Multimodal Data

Different molecular assays are needed to capture different aspects of both the
microbiome and the host immunological environment. 

* Results in multiple tables of data, each potentially high-dimensional
* Typically gather data over time (but not necessarily on the same samples)

---

### Multimodal Data

* Human Host
  - Single Cell RNA-seq: How are genes from different host cell types expressed?
  - Cytokine Assays: Which immune system cells are present?
  - Survey Data: What host behaviors may influence disease trajectory?
* Microbiome
  - 16S rRNA sequence: What are the bacterial species abundances?
  - Metagenomic Sequencing: What functions can those bacteria potentially carry out?
  - Metatranscriptomic Sequencing: Which genes are expressed?
* Either
  - Metabolomics: What small molecules are present?

---

### Integrated Learning

Tools are needed across the entire data collection and analysis workflow:

* Experimental design and power analysis.
* Normalization, batch effect correction, missing data imputation.
* Disease state/trajectory prediction.
* Interpretation and visualization.

---

### Example: Intervention Analysis

What would longitudinal trajectories be like with or without specific
interventions? We adapted ideas from the transfer function methodology.

.center[
<img src="https://krisrs1128.github.io/mbtransfer/articles/postpartum_files/figure-html/unnamed-chunk-15-1.png"/>
]

[Microbiome Intervention Analysis with Transfer Functions and Mirror Statistics](https://arxiv.org/abs/2306.06364)

---

.center[
## Closing Thoughts
]

---

### Mount Chimborazo

This is one of my favorite visualizations from the history of science.

.center[
<img width=950 src="figure/Geographie_der_Pflanzen_in_den_Tropen-Ländern.jpg"/>
]

---

### Mount Chimborazo

It is Alexander von Humboldt's *Tableau Physique*, and it shows how multiple data
sources can be combined to create a unified view of the world^[It is also remarkable how it anticipates many ideas from functional genomics.].

.center[
<img width=820 src="figure/Geographie_der_Pflanzen_in_den_Tropen-Ländern.jpg"/>
]

---

### Interdependence

At a time when most science focused on taxonomy, the *Tableau* highlighted interdependence and unity within nature.

.center[
<img width=820 src="figure/Geographie_der_Pflanzen_in_den_Tropen-Ländern.jpg"/>
]

---

### References

```{r, results='asis', echo = FALSE}
PrintBibliography(bib, start = 1, end = 4)
```
