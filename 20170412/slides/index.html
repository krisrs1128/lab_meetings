<!DOCTYPE html>
<html>
  <head>
      <title>Title</title>
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
      <script src="phylo_ix.js"></script>
      <script src="relative_day.js"></script>
      <script src="models.js"></script>
      <script src="data/combined.js"></script>
      <script src="data/rsv.js"></script>
      <script src="data/order_levels.js"></script>
      <script src="data/order_top_levels.js"></script>
      <script src="data/f_combined.js"></script>
      <script src="title.js"></script>
      <script src="setup.js"></script>
      <link href='css/style.css' rel='stylesheet' type='text/css'>
  </head>
  <body>
      <div id="vis"></div>
	    <div id="section">
		      <div id="sectionTitle"></div>
	        <div id="sectionText"></div>
	    </div>
      <script>
       var width = 1000;
       var height = 600;

       function feature_array(name) {
           return combined.map(function(d) {return d[name] });
       }

       function feature_extent(name) {
           return d3.extent(feature_array(name));
       }

       var scales = {
           "taxa_top": d3.scaleBand()
                         .domain(order_top_levels)
                         .range([20, width - 20]),
           "subject": d3.scaleBand()
                        .domain(d3.set(feature_array("subject")).values())
                        .range([height - 10, 10]),
           "phylo_ix": d3.scaleLinear()
                         .domain(feature_extent("phylo_ix"))
                         .range([20, width - 20]),
           "counts": d3.scaleLinear()
                       .domain(feature_extent("jittered_count")),
           "binarized": d3.scaleLinear()
                          .domain(feature_extent("jittered_binarized")),
           "relative_day": d3.scaleLinear()
                             .domain(feature_extent("relative_day")),
           "taxa": d3.scaleBand()
                     .domain(order_levels)
                     .range([20, width - 20]),
           "taxa_cols": d3.scaleOrdinal()
                          .domain(order_top_levels)
                          .range(["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3",
                                  "#a6d854", "#ffd92f", "#e5c494", "#b3b3b3"])
       }

       scales.counts.range([scales.subject.step(), 10]);
       scales.binarized.range([scales.subject.step(), 10]);
       scales.relative_day.range([0, scales.taxa_top.step()]);

       var line_fun;
       setup_page();
       title_page();
       initialize_samples();
       initialize_partial_dependence();
       counts_taxa();
       taxa_partial_dependence();
       //setTimeout(counts_phylo_ix, 2000);
       //setTimeout(binarize_phylo_ix, 4000);
       //initialize_rsvs();
       //setTimeout(counts_relative_day, 5000);
      </script>
  </body>
</html>
